```{r}
# We need to library certain packages that will most likely be used while we are cleaning the data and will be most likely used for the analysis.
library(tidyverse)
library(ggplot2)
library(readxl)
library(dplyr)
library(sjmisc)
library(stringr)
library(ExcelFunctionsR)
```


```{r}
#We will need to read in the file and edit columns that are not needed for our analysis.
MovieStreaming<-read.csv("/Users/sarahgoodwyn/Desktop/MoviesOnStreamingPlatforms_updated 4.csv")
MovieStreaming<-MovieStreaming[,-1]
MovieStreaming<-MovieStreaming[,-11]

# We need to look at the structure of the data frame to determine what changes we need to make to the data in terms of the class. We determined we will need to eliminate the slash marks in the ratings and make them numeric so we can manipulate them accordingly. 
str(MovieStreaming)
MovieStreaming$IMDb<-as.numeric(str_remove(MovieStreaming$IMDb,"/10"))
MovieStreaming$Rotten.Tomatoes<-as.numeric(str_remove(MovieStreaming$Rotten.Tomatoes,"/100"))

```


```{r}
# Now, we determine how to handle blanks and NA values. We started by looking at how many blanks there were in each column determining we could eliminate some entries to our data - any movies that had blank country, directors, genres or language was deleted. We also decided to replace the age category "all" with "1+" so it better aligns with the rest of the entries. 
colSums(MovieStreaming=="")
MovieStreaming<-MovieStreaming[!MovieStreaming$Country=="",]
MovieStreaming<-MovieStreaming[!MovieStreaming$Directors=="",]
MovieStreaming<-MovieStreaming[!MovieStreaming$Genres=="",]
MovieStreaming<-MovieStreaming[!MovieStreaming$Language=="",]
MovieStreaming$Age<-replace(MovieStreaming$Age,MovieStreaming$Age=="all","1+")
colSums(is.na(MovieStreaming))
#After looking at our options for replacing blanks in the IMDb ratings, Rotten Tomatoes ratings, and runtime, we decided to replace blanks with the mean values of each category.
MovieStreaming$IMDb<-replace_na(MovieStreaming$IMDb,value=round(mean(MovieStreaming$IMDb,na.rm=TRUE),digits=0))
MovieStreaming$Rotten.Tomatoes<-replace_na(MovieStreaming$Rotten.Tomatoes,value=round(mean(MovieStreaming$Rotten.Tomatoes,na.rm=TRUE),digits=0))
MovieStreaming$Runtime<-replace_na(MovieStreaming$Runtime,value=round(mean(MovieStreaming$Runtime,na.rm=TRUE),digits=0))
#Once again we check how many blanks and NAs are in the dataset and find there are no longer any, so we can begin analysis.
colSums(MovieStreaming=="")
colSums(is.na(MovieStreaming))
```


```{r}
# For the blanks concerning the Age column, we decided to remove the plus sign and find the mean value of the age groups. Since we converted the "all" category to "1+" we are able to find the mean by eliminating the '+' in the age category. Once we have filled in the NAs, we add the '+' back and convert the column results back to characters.
MovieStreaming$Age<-as.numeric(str_remove(MovieStreaming$Age,"\\+"),na.rm=TRUE)
MovieStreaming$Age<-replace_na(MovieStreaming$Age,value=round(mean(MovieStreaming$Age,na.rm=TRUE),digits=0))
MovieStreaming$Age<-as.character(paste(MovieStreaming$Age,"+",sep=""))
```


```{r}
# We created a function to create binary variables for each genre then, applied each the function for each genre in the dataframe.
genrereturn<-function(x) {
  if_else(grepl(x,MovieStreaming$Genres),"1","0")
}
MovieStreaming$Action<-genrereturn("Action")
MovieStreaming$Adventure<-genrereturn("Adventure")
MovieStreaming$Animation<-genrereturn("Animation")
MovieStreaming$Biography<-genrereturn("Biography")
MovieStreaming$Comedy<-genrereturn("Comedy")
MovieStreaming$Crime<-genrereturn("Crime")
MovieStreaming$Documentary<-genrereturn("Documentary")
MovieStreaming$Drama<-genrereturn("Drama")
MovieStreaming$Family<-genrereturn("Family")
MovieStreaming$Fantasy<-genrereturn("Fantasy")
MovieStreaming$FilmNoir<-genrereturn("Film-Noir")
MovieStreaming$GameShow<-genrereturn("Game-Show")
MovieStreaming$History<-genrereturn("History")
MovieStreaming$Horror<-genrereturn("Horror")
MovieStreaming$Music<-genrereturn("Music")
MovieStreaming$Musical<-genrereturn("Musical")
MovieStreaming$Mystery<-genrereturn("Mystery")
MovieStreaming$News<-genrereturn("News")
MovieStreaming$RealityTV<-genrereturn("Reality-TV")
MovieStreaming$Romance<-genrereturn("Romance")
MovieStreaming$SciFi<-genrereturn("Sci-Fi")
MovieStreaming$Short<-genrereturn("Short")
MovieStreaming$Sport<-genrereturn("Sport")
MovieStreaming$TalkShow<-genrereturn("Talk-Show")
MovieStreaming$Thriller<-genrereturn("Thriller")
MovieStreaming$War<-genrereturn("War")
MovieStreaming$Western<-genrereturn("Western")
```


```{r}
# We also created a function for finding the IMDb and Rotten Tomatoes rating averages for each platform.
allimdbavg<-function(x){
  c(round(AVERAGEIF(MovieStreaming$Netflix,"1",x),digits=1),round(AVERAGEIF(MovieStreaming$Hulu,"1",x),digits=1),round(AVERAGEIF(MovieStreaming$Prime.Video,"1",x),digits=1),round(AVERAGEIF(MovieStreaming$Disney.,"1",x),digits=1))
}
```


```{r}
allrtavg<-function(x){
  c(round(AVERAGEIF(MovieStreaming$Netflix,"1",x),digits=0),round(AVERAGEIF(MovieStreaming$Hulu,"1",x),digits=0),round(AVERAGEIF(MovieStreaming$Prime.Video,"1",x),digits=0),round(AVERAGEIF(MovieStreaming$Disney.,"1",x),digits=0))
}
```


```{r}
# Created a singular data frame for all the rating averages.
dfavg<-data.frame("Platform"=c("Netflix","Hulu","Prime",'Disney +'),"IMDb Average"=allimdbavg(MovieStreaming$IMDb),"Rotten Tomatoes Average"=allrtavg(MovieStreaming$Rotten.Tomatoes))

```


```{r}
# We then determined we would want to know the average rating for IMDb and Rotten Tomatoes per genre. We created a function for each of the rating platforms, then created dataframes. Once the two separate dataframes are created we combined them into one dataframe eliminating duplicate columns and blank rows.
imdbavgs<-function(x){
  c(round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Action,"1"),digits = 1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Adventure,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Animation,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Biography,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Comedy,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Crime,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Documentary,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Drama,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Family,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Fantasy,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$FilmNoir,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$GameShow,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$History,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Horror,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Music,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Musical,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Mystery,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$News,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$RealityTV,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Romance,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$SciFi,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Short,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Sport,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$TalkShow,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Thriller,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$War,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$IMDb,x,"1",MovieStreaming$Western,"1"),digits=1))
}
```


```{r}
rtavgs<-function(x){
  c(round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Action,"1"),digits = 1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Adventure,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Animation,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Biography,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Comedy,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Crime,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Documentary,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Drama,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Family,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Fantasy,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$FilmNoir,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$GameShow,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$History,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Horror,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Music,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Musical,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Mystery,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$News,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$RealityTV,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Romance,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$SciFi,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Short,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Sport,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$TalkShow,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Thriller,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$War,"1"),digits=1),round(AVERAGEIFS(MovieStreaming$Rotten.Tomatoes,x,"1",MovieStreaming$Western,"1"),digits=1))
}
```


```{r}
imdbdfavggenre<-data.frame("Genre"=c(colnames(MovieStreaming[,16:42])),
"Netflix IMDb"=imdbavgs(MovieStreaming$Netflix),"Hulu IMDb"=imdbavgs(MovieStreaming$Hulu), "Prime Video IMDb"= imdbavgs(MovieStreaming$Prime.Video),"Disney + IMDb"=imdbavgs(MovieStreaming$Disney.))
```


```{r}
rtdfavggenre<-data.frame("Genre"=c(colnames(MovieStreaming[,16:42])),
"Netflix RT"=rtavgs(MovieStreaming$Netflix),"Hulu RT"=rtavgs(MovieStreaming$Hulu), "Prime Video RT"= rtavgs(MovieStreaming$Prime.Video),"Disney + RT"=rtavgs(MovieStreaming$Disney.))
```


```{r}
allavgs<-data.frame(c(imdbdfavggenre,rtdfavggenre))
allavgs<-allavgs[,-6]
```


```{r}
#A scatterplot was created for both IMDb and Rotten Tomato average scores per platform to compare how different platforms' content was rated. From what we have determined, Disney+ has the overall average highest score for IMDb and Hulu has the highest average for Rotten Tomatoes.
IMDb<-ggplot(data = dfavg,aes(x=Platform,y=IMDb.Average,group=Platform))+geom_point(aes(color=Platform))+scale_color_manual(values=c("#113CCF", "#3DBB3D", "#E50914","#00A8E1"))
IMDb<-print(IMDb+ggtitle("IMDb Averages")+labs(y="IMDb Average"))
RT<-ggplot(data = dfavg,aes(x=Platform,y=Rotten.Tomatoes.Average,group=Platform))+geom_point(aes(color=Platform))+scale_color_manual(values=c("#113CCF", "#3DBB3D", "#E50914","#00A8E1"))
RT<-print(RT+ggtitle("Rotten Tomatoes Averages")+labs(y="Rotten Tomatoes Average"))
```


```{r}
NetflixColor<-"#E50914"
HuluColor<-"#3dbb3d"
DisneyColor<-"#113CCF"
PrimeColor<-"#00A8E1"
Scatter<-ggplot(data=imdbdfavggenre,aes(x=Genre,y=Netflix.IMDb, colour="Netflix"))+geom_point()+geom_point(aes(x=Genre,y=Hulu.IMDb,color="Hulu"))+geom_point(aes(x=Genre,y=Prime.Video.IMDb,color='Prime Video'))+geom_point(aes(x=Genre,y=Disney...IMDb,color='Disney +'))+scale_color_manual(values=c(DisneyColor,HuluColor,NetflixColor,PrimeColor))
Scatter<-print(Scatter+ggtitle("IMDb Average by Genre")+labs(y="IMDb Average"))
# Looking at the scatter plots for Genre, we see Disney + seems to dominate in most genres.
```


```{r}
Scatter2<-ggplot(data=rtdfavggenre,aes(x=Genre,y=Netflix.RT, colour="Netflix"))+geom_point()+geom_point(aes(x=Genre,y=Hulu.RT,color="Hulu"))+geom_point(aes(x=Genre,y=Prime.Video.RT,color='Prime Video'))+geom_point(aes(x=Genre,y=Disney...RT,color='Disney +'))+scale_color_manual(values=c(DisneyColor,HuluColor,NetflixColor,PrimeColor))
Scatter2<-print(Scatter+ggtitle('Rotten Tomatoes Average by Genre')+labs(y='Rotten Tomatoes Average'))
#Even though Hulu has the highest average rating on Rotten Tomatoes, just looking at the scatter plot, you would think Disney + had the highest average rating.
```


```{r}
modelRTAllFactors<-lm(Rotten.Tomatoes ~Year+Age+Netflix+Hulu+Prime.Video+Disney.+Runtime+Action + Adventure + Animation + Biography + Comedy + Crime + Documentary + Drama + Family + Fantasy + FilmNoir + History + Horror + Music + Musical + Mystery + News + RealityTV + Romance + SciFi + Short + Sport + TalkShow + Thriller + War + Western, data = MovieStreaming)
summary(modelRTAllFactors)
modelIMDbAllFactors<-lm(IMDb ~Year+Age+Netflix+Hulu+Prime.Video+Disney.+Runtime+Action + Adventure + Animation + Biography + Comedy + Crime + Documentary + Drama + Family + Fantasy + FilmNoir + History + Horror + Music + Musical + Mystery + News + RealityTV + Romance + SciFi + Short + Sport + TalkShow + Thriller + War + Western, data = MovieStreaming)
summary(modelIMDbAllFactors)
```

```{r}
runtimeavgs<-function(x){
  c(round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Action,"1"),digits = 0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Adventure,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Animation,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Biography,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Comedy,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Crime,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Documentary,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Drama,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Family,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Fantasy,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$FilmNoir,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$GameShow,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$History,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Horror,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Music,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Musical,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Mystery,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$News,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$RealityTV,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Romance,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$SciFi,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Short,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Sport,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$TalkShow,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Thriller,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$War,"1"),digits=0),round(AVERAGEIFS(MovieStreaming$Runtime,x,"1",MovieStreaming$Western,"1"),digits=0))
}
```



```{r}
library(readr)
library(tidytext)
library(readtext)
library(OptimalCutpoints)
library (tm)
library(slam)
library(wordcloud)
library(quanteda)
df_corp<-corpus(MovieStreaming$Genres)
df_corp2<- df_corp[which(df_corp != "")]
tokens<-tokens(df_corp2,remove_punct = TRUE,remove_symbols = TRUE,
  remove_numbers = TRUE,remove_url = FALSE,remove_separators = TRUE)
tokens<-tokens_select(tokens,stopwords('english'),selection='remove')
dfm<-dfm(tokens,tolower=TRUE)
library(quanteda.textplots)
wordcloud<-textplot_wordcloud(dfm,min_count = 1)
df_corp3<-corpus(as.character(MovieStreaming$Language))
df_corp4<- df_corp3[which(df_corp3 != "")]
tokens<-tokens(df_corp4,remove_punct = TRUE,remove_symbols = TRUE,
  remove_numbers = FALSE,remove_url = FALSE,remove_separators = FALSE)
tokens<-tokens_select(tokens,stopwords('english'),selection='remove')
dfm2<-dfm(tokens,tolower=TRUE)
wordcloud2<-textplot_wordcloud(dfm2,min_count = 1)

```

```{r}

library(shiny)
sidePanel<-sidebarPanel(
  selectInput("xaxis", label ="select x-axis",choices=colnames(MovieStreaming[,c(3,5,6,15,4)])
              ),
  selectInput("yaxis",label="select y-axis",choices = colnames(MovieStreaming[,c(3,5,6,15,4)])
              )
  )

```

Create the mainPanel to show the scatter plot.

```{r}
mainPanel <- mainPanel(
plotOutput(outputId = "scatterplot")
)
```

# Define UI for application (called ui)

Use a 'fluidPage' using the sidebarLayout, and your sidePanel and mainPanel
```{r}
ui <- fluidPage(
    titlePanel("IMDb Ratings based on Platforms"),
    sidebarLayout(
        sidebarPanel(sidePanel),
        mainPanel(mainPanel)
     )
)

```

## Now let's define the server

Use ggplot to render a scatter plot, using the tbCan dataframe, the input for the x-axis and the input for the y-axis.

Store the results in the 'server' variable

```{r}

server <- function(input, output) {
  output$scatterplot <- renderPlot({
    ggplot(data=MovieStreaming,
           aes_string(x=input$xaxis,y=input$yaxis,color=MovieStreaming$Rotten.Tomatoes,size=MovieStreaming$IMDb))+
      geom_point()
  })
}

```

Now run the shiny App
```{r}
 
shinyApp(ui = ui, server = server)

library(rsconnect)